.d-flex.justify-content-between.mb-4
  .align-self-center
    %h1.mb-0.fw-bold= @trip.title
    %p.mb-0.fs-4.fw-semibold.text-secondary= @trip.formatted_date_range

  .d-flex.flex-column.align-items-end.gap-3
    = render("partials/trips/members", members: @trip.trip_memberships)

    .d-flex.gap-2
      = link_to(new_trip_plan_path(@trip), class: "btn btn-primary py-2") do
        %i.bi.bi-plus-circle &nbsp
        Add Plan

      #trip-settings.dropdown
        %button.h-100.btn.btn-secondary.dropdown-toggle.py-2{
          type: "button",
          data: {
            bs_toggle: "dropdown",
          },
          aria: {
            expanded: "false",
          },
        }
          %i.bi.bi-gear-fill

        .dropdown-menu
          = link_to(edit_trip_path(@trip), class: "dropdown-item") do
            %i.bi.bi-pencil-fill &nbsp;
            Edit trip

          = link_to(trip_trip_memberships_path(@trip),
                    class: "dropdown-item") do
            %i.bi.bi-person-fill-gear &nbsp;
            Manage members

          = link_to(trip_path(@trip),
                    class: "dropdown-item text-danger",
                    method: :delete,
                    data: { confirm: "Are you sure you want to delete this trip?" }) do
            %i.bi.bi-trash-fill &nbsp;
            Delete trip

- if @plan_groups.empty?
  %p No plans have been added to this trip yet.
- else
  - @plan_groups.each_with_index do |(start_date, plans), index|
    %button.btn.collapse-btn.px-0.py-2.w-100.text-uppercase.text-start.text-body-secondary.fs-5.fw-semibold{
      type: "button",
      data: {
        bs_toggle: "collapse",
        bs_target: "#plans#{index}",
      },
      aria: {
        expanded: "false",
        controls: "plans#{index}",
      },
    }
      = start_date.strftime("%A %d %b")
      %i.bi.bi-chevron-up.float-end

    .collapse.show.mb-3{ id: "plans#{index}" }
      - plans.each do |plan|
        .row.mb-2
          .col-sm-2
            %p.mb-0.fw-semibold.fs-5.text-body-secondary= plan.start_date.strftime("%H:%M")
          .col
            - if plan.plan_type.starts_with?("travel_")
              = render("partials/plans/travel_card", trip: @trip, plan: plan)
            - else
              = render("partials/plans/event_card", trip: @trip, plan: plan)
